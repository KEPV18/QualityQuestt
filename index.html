<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Tracker</title>
    <link rel="icon" href="360_F_518939699_8Zco4PagLxKxIFzWj7zYiZD6xSE9Ynb5.jpg" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #121212;
            color: #e0e0e0;
        }
        h1, h2, h3, h4 {
            color: #ff69b4;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        p {
            margin-bottom: 40px;
        }
        #teamSelect {
            margin-bottom: 20px;
            padding: 15px 25px;
            font-size: 16px;
            border: 2px solid #ff69b4;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #1f1f1f, #2a2a2a);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            color: #e0e0e0;
            font-weight: 500;
            cursor: pointer;
            outline: none;
            min-width: 200px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: linear-gradient(45deg, #2d2d2d, #232323),
                url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FF69B4%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px top 50%, 0 0;
            background-size: 12px auto, 100%;
            padding-right: 40px;
        }
        #teamSelect:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.3);
            border-color: #ff1493;
        }
        #teamSelect:focus {
            border-color: #ff1493;
            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.3);
        }
        #teamSelect option {
            padding: 15px;
            background-color: #2d2d2d;
            color: #ffffff;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
        #teamSelect option:hover {
            background-color: #ff69b4;
            color: white;
        }
        #teamSelect option:checked {
            background-color: #ff69b4;
            color: white;
            font-weight: bold;
        }
        #teamSelect option:first-child {
            font-style: italic;
            color: #cccccc;
        }
        table {
            border-collapse: collapse;
            width: 80%;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            background: #1f1f1f;
        }
        th, td {
            border: 1px solid #ff69b4;
            padding: 12px;
            text-align: center;
            color: #ffffff;
        }
        th {
            background: linear-gradient(45deg, #800040, #ff69b4);
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        tr:nth-child(even) {
            background-color: #2d2d2d;
        }
        tr:nth-child(odd) {
            background-color: #232323;
        }
        tr:hover {
            background: #2a2a2a;
            transition: all 0.3s ease;
        }
        .card-container {
            display: flex;
            justify-content: space-around;
            width: 80%;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .card {
            background-color: #1f1f1f;
            border: 1px solid #ff69b4;
            border-radius: 10px;
            padding: 20px;
            width: 22%;
            text-align: center;
            position: relative;
            margin: 10px;
            transition: transform 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            color: #ffffff;
            transform-origin: center;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 15px 30px rgba(255, 105, 180, 0.2);
        }
        .balloon {
            font-size: 30px;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }
        .card:hover .balloon {
            opacity: 1;
            animation: fly 1s forwards;
        }
        @keyframes fly {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100px); opacity: 0; }
        }
        .loader {
            display: none;
            margin: 20px auto;
            width: 50px;
            height: 50px;
            border: 4px solid #ff69b4;
            border-radius: 50%;
            border-top-color: transparent;
            transform-origin: center center;
            animation: spin 0.8s linear infinite;
            background: conic-gradient(transparent, #ff69b4);
        }
        .loader::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60px;
            height: 60px;
            border: 3px solid #ff69b4;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.3;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .loader::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            background-color: #1a1a1a;
            border-radius: 50%;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            table {
                width: 100%;
            }
            .card-container {
                flex-direction: column;
                align-items: center;
            }
            .card {
                width: 80%;
                margin-bottom: 20px;
            }
        }

        .copy-button {
            padding: 5px 10px;
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .copy-button:hover {
            background: linear-gradient(45deg, #ff1493, #ff69b4);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.3);
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        td:nth-child(3) {
            font-weight: bold;
            color: #daa520;
        }

        #notification {
            background: #ff69b4;
            color: #ffffff;
        }

        h1 {
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin: 30px 0;
        }

        #notification {
            background: linear-gradient(45deg, #0db854, #00ff7f);
            transform: translateY(100px);
            transition: all 0.5s ease;
        }

        #notification.show {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div id="welcomeMessage">Welcome to TT, short for Team Tracker by Ahmed Khaled</div>
    <h1>Team Tracker</h1>
    
    <!-- Encouragement message -->
    <div id="encouragementMessage" style="color: #daa520; font-size: 1.2em; margin-bottom: 20px;"></div>
    
    <select id="teamSelect" onchange="updateTable()">
        <option value="">Select Team</option>
        <option value="nermin">Nermin</option>
        <option value="Ahmed Khaled">Ahmed Khaled</option>
        <option value="aya">Aya</option>
    </select>

    <div class="loader" id="loader"></div>

    <table border="1" id="teamTable">
        <thead>
            <tr>
                <th>Device</th>
                <th>E-Mail</th>
                <th>Name</th>
                <th>Quality</th>
                <th>Tasks Completed Today</th>
                <th>Quality per Day</th>
                <th>Last Task</th>
            </tr>
        </thead>
        <tbody id="teamTableBody">
        </tbody>
    </table>

    <div class="card-container" style="flex-wrap: nowrap; justify-content: space-between; width: 100%;">
        <div class="card" style="flex: 1; margin: 10px;">
            <div class="balloon">üéà</div>
            <h3>Top Team</h3>
            <p id="topTeamText">N/A</p>
        </div>
        <div class="card" style="flex: 1; margin: 10px;">
            <div class="balloon">üéà</div>
            <h3>Team Ranking</h3>
            <div id="teamRanking">N/A</div>
        </div>
        <div class="card" style="flex: 1; margin: 10px;">
            <div class="balloon">üéà</div>
            <h3>Top 3 Tasks</h3>
            <div id="topThreeTasks">N/A</div>
        </div>
        <div class="card" style="flex: 1; margin: 10px;">
            <div class="balloon">üéà</div>
            <h3>Top 3 Quality</h3>
            <div id="topThreeQuality">N/A</div>
        </div>
    </div>

    <div id="settingsIcon" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
        <i class="fas fa-cog" title="Settings"></i>
    </div>

    <!-- Password input modal -->
    <div id="passwordModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 1000;">
        <h3>Enter Password</h3>
        <input type="password" id="passwordInput" placeholder="Enter password" />
        <button id="submitPassword">Submit</button>
        <button id="cancelPassword">Cancel</button>
    </div>

    <!-- Notification element -->
    <div id="notification" style="display: none; position: fixed; bottom: 20px; right: 20px; background-color: #0db854; color: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.5);">
        Link copied to clipboard!
    </div>

    <script>
        const apiKey = 'AIzaSyDctNVWQhbsQMEDfJDXI30emaTd8mtviEY';
        const sheetId = '1JbElBBvoEWvkyJ8aWhmSTh3MnMDEfHu9K3vaiyuNZ7s';

        let trackingData;
        let teamNames = new Set();

        async function fetchGoogleSheetData(sheetName, range) {
            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?key=${apiKey}`);
            const data = await response.json();
            return data.values;
        }

        async function populateTeamSelect() {
            try {
                const data = await fetchGoogleSheetData("tracking(M)", "B3:B1000");
                if (!data || !Array.isArray(data)) {
                    console.error("Data is not an array or is undefined:", data);
                    return;
                }
                data.forEach(row => {
                    if (row[0]) {
                        teamNames.add(row[0]);
                    }
                });

                const teamSelect = document.getElementById("teamSelect");
                teamSelect.innerHTML = '<option value="">Select Team</option>';
                teamNames.forEach(team => {
                    const option = document.createElement("option");
                    option.value = team;
                    option.textContent = team;
                    teamSelect.appendChild(option);
                });
            } catch (error) {
                console.error("Error fetching or processing data:", error);
            }
        }

        async function updateTable() {
            const teamSelect = document.getElementById("teamSelect");
            const selectedTeam = teamSelect.value;
            const teamTableBody = document.getElementById("teamTableBody");
            const loader = document.getElementById("loader");

            if (!selectedTeam) {
                teamTableBody.innerHTML = '<tr><td colspan="7">Please select a team.</td></tr>';
                return;
            }

            loader.style.display = 'block';

            trackingData = await fetchGoogleSheetData("tracking(M)", "A1:Z1000");

            loader.style.display = 'none';
            teamTableBody.innerHTML = '';

            // Filter and sort the data based on qualityForAll
            const teamData = trackingData.filter(row => row[1] === selectedTeam)
                .map(row => ({
                    device: row[0] || "N/A",
                    email: row[2] || "N/A",
                    name: row[5] || "N/A",
                    tasksCompleted: row[13] || "N/A",
                    quality: parseFloat(row[12]) || 0,
                    qualityForAll: parseFloat(row[7]) || 0,
                    lastTaskLink: row[24] || ""
                }))
                .sort((a, b) => {
                    // Sort by qualityForAll in descending order
                    const qualityA = parseFloat(a.qualityForAll) || 0;
                    const qualityB = parseFloat(b.qualityForAll) || 0;
                    return qualityB - qualityA;
                });

            // Add sorted data to the table
            teamData.forEach((member, index) => {
                const rowElement = document.createElement("tr");
                const tasksColor = member.tasksCompleted < 70 ? 'red' : 'green';
                const qualityColor = member.quality < 75 ? 'red' : 'green';

                // Determine rank suffix
                const rankSuffix = (index + 1) === 1 ? 'st' : (index + 1) === 2 ? 'nd' : (index + 1) === 3 ? 'rd' : 'th';
                const rankDisplay = `<span style="color: #daa520;">${index + 1}${rankSuffix} ‚≠ê</span>`;

                rowElement.innerHTML = `
                    <td>${member.device}</td>
                    <td>${member.email}</td>
                    <td>${member.name}</td>
                    <td>${member.qualityForAll} ${rankDisplay}</td>
                    <td style="color: ${tasksColor};">${member.tasksCompleted}</td>
                    <td style="color: ${qualityColor};">${member.quality}</td>
                    <td>
                        ${member.lastTaskLink ? `<button onclick="copyToClipboard('${member.lastTaskLink}')" class="copy-button">
                            <i class="fas fa-copy"></i> Copy Last Task
                        </button>` : 'N/A'}
                    </td>
                `;
                rowElement.classList.add('fade-in');
                teamTableBody.appendChild(rowElement);

                setTimeout(() => {
                    rowElement.classList.add('visible');
                }, index * 100);
            });

            calculateTeamPerformance();
            calculateIndividualPerformance();
            updateTopHeart();
            showRandomBalloons();

            // Auto-refresh the table every minute to keep rankings updated
            setTimeout(updateTable, 300000);
        }

        function showRandomBalloons() {
    const balloonCount = Math.floor(Math.random() * 6) + 5;
    const balloonContainer = document.querySelectorAll('.balloon');
    const heartSymbol = '‚ù§Ô∏è';

    balloonContainer.forEach(balloon => {
        balloon.style.opacity = '0';
    });

    for (let i = 0; i < balloonCount; i++) {
        const balloon = document.createElement('div');
        balloon.className = 'balloon';
        balloon.innerHTML = Math.random() < 0.5 ? 'üéà' : heartSymbol;
        balloon.style.position = 'absolute';
        balloon.style.left = Math.random() * 100 + 'vw';
        balloon.style.top = Math.random() * 100 + 'vh';
        balloon.style.opacity = '1';
        balloon.style.transition = 'opacity 0.5s';
        document.body.appendChild(balloon);

        setTimeout(() => {
            balloon.style.transform = `translateY(-${Math.random() * 50 + 50}px)`;
        }, 100);

        setTimeout(() => {
            balloon.style.opacity = '0';
            setTimeout(() => {
                balloon.remove();
            }, 500);
        }, 5000);
    }
}


        function updateTopHeart() {
            const teamTableBody = document.getElementById("teamTableBody");
            const rows = teamTableBody.getElementsByTagName("tr");
            let topTaskMember = null;
            let topQualityMember = null;

            for (let row of rows) {
                const tasksCompleted = parseInt(row.cells[5].innerText) || 0;
                const quality = parseInt(row.cells[6].innerText) || 0;

                if (tasksCompleted > 1 && (!topTaskMember || tasksCompleted > topTaskMember.tasks)) {
                    topTaskMember = { row, tasks: tasksCompleted };
                }
                if (quality > 1 && (!topQualityMember || quality > topQualityMember.quality)) {
                    topQualityMember = { row, quality };
                }
            }

            const hearts = document.querySelectorAll('.heart');
            hearts.forEach(heart => heart.remove());

            if (topTaskMember) {
                const heart = document.createElement('span');
                heart.className = 'heart';
                heart.innerHTML = '‚ù§Ô∏è';
                topTaskMember.row.cells[3].appendChild(heart);
            }

            if (topQualityMember) {
                const heart = document.createElement('span');
                heart.className = 'heart';
                heart.innerHTML = '‚ù§Ô∏è';
                topQualityMember.row.cells[3].appendChild(heart);
            }
        }

        function copyToClipboard(link) {
            navigator.clipboard.writeText(link).then(() => {
                showNotification("Link copied to clipboard!");
            }).catch(err => {
                console.error("Failed to copy link: ", err);
            });
        }

        function showNotification(message) {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.style.display = 'none';
                notification.classList.remove('show');
            }, 3000); // Hide after 3 seconds
        }

        function calculateTeamPerformance() {
            const performanceData = {};

            teamNames.forEach(team => {
                performanceData[team] = {
                    tasksCompleted: 0,
                    quality: 0,
                    activeMembers: 0,
                    averageTasks: 0,
                    averageQuality: 0
                };

                trackingData.forEach(row => {
                    if (row[1] === team) {
                        const tasksCompleted = parseInt(row[13]) || 0;
                        const quality = parseInt(row[12]) || 0;

                        if (tasksCompleted > 1 && quality > 1) {
                            performanceData[team].tasksCompleted += tasksCompleted;
                            performanceData[team].quality += quality;
                            performanceData[team].activeMembers++;
                        }
                    }
                });

                if (performanceData[team].activeMembers > 0) {
                    performanceData[team].averageTasks = Math.round(performanceData[team].tasksCompleted / performanceData[team].activeMembers);
                    performanceData[team].averageQuality = Math.round(performanceData[team].quality / performanceData[team].activeMembers);
                }
            });

            const sortedTeams = Object.entries(performanceData).sort((a, b) => {
                return b[1].averageTasks - a[1].averageTasks;
            });

            const topTeamsDiv = document.getElementById("topTeamText");
            const topTeam = sortedTeams[0];
            if (topTeam && topTeam[1].activeMembers > 0) {
                topTeamsDiv.innerHTML = `
                    <strong>${topTeam[0]}</strong> with average of 
                    <strong>${topTeam[1].averageTasks}</strong> tasks and 
                    <strong>${topTeam[1].averageQuality}</strong> quality points per active member 
                    (${topTeam[1].activeMembers} active members)`;
            } else {
                topTeamsDiv.innerHTML = `<strong>N/A</strong>`;
            }

            const teamRankingDiv = document.getElementById("teamRanking");
            const teamRankingHtml = sortedTeams.map((team, index) => {
                if (team[1].activeMembers > 0) {
                    return `${index + 1}. <strong>${team[0]}</strong>: 
                            Average <strong>${team[1].averageTasks}</strong> tasks, 
                            <strong>${team[1].averageQuality}</strong> quality points 
                            (${team[1].activeMembers} active members)`;
                }
                return '';
            }).filter(Boolean).join('<br>');
            teamRankingDiv.innerHTML = `${teamRankingHtml || 'No teams with active members.'}`;
        }

        function calculateIndividualPerformance() {
            const individualPerformance = [];

            for (const team in teamNames) {
                trackingData.forEach(row => {
                    if (row[1] === team) {
                        const tasksCompleted = parseInt(row[13]) || 0;
                        const quality = parseInt(row[12]) || 0;

                        if (tasksCompleted > 1 && quality > 1) {
                            individualPerformance.push({
                                name: row[5],
                                tasksCompleted: tasksCompleted,
                                quality: quality
                            });
                        }
                    }
                });
            }

            const topThreeTasks = individualPerformance.sort((a, b) => b.tasksCompleted - a.tasksCompleted).slice(0, 3);
            const topThreeTasksHtml = topThreeTasks.map(person => {
                return `<strong>${person.name}</strong>: <strong>${person.tasksCompleted}</strong> tasks`;
            }).join('<br>');
            document.getElementById("topThreeTasks").innerHTML = `${topThreeTasksHtml || 'N/A'}`;

            const topThreeQuality = individualPerformance.sort((a, b) => b.quality - a.quality).slice(0, 3);
            const topThreeQualityHtml = topThreeQuality.map(person => {
                return `<strong>${person.name}</strong>: <strong>${person.quality}</strong> quality points`;
            }).join('<br>');
            document.getElementById("topThreeQuality").innerHTML = `${topThreeQualityHtml || 'N/A'}`;
        }

        const encouragementMessages = [
            "Keep up the hard work!",
            "You're making progress!",
            "Stay focused on your goals!",
            "Your effort is paying off!",
            "Keep pushing forward!",
            "You're doing great work!",
            "Stay committed!",
            "Your dedication shows!",
            "Keep striving for success!",
            "You're on the right path!",
            "Stay motivated!",
            "Your hard work matters!",
            "Keep aiming high!",
            "You're achieving your goals!",
            "Stay determined!",
            "Your persistence is key!",
            "Keep improving!",
            "You're building success!",
            "Stay on track!",
            "Your work is valuable!",
            "Keep reaching for more!",
            "You're making a difference!",
            "Stay productive!",
            "Your focus is impressive!",
            "Keep setting new goals!",
            "You're a hard worker!",
            "Stay ambitious!",
            "Your progress is inspiring!",
            "Keep challenging yourself!",
            "You're a go-getter!",
            "Stay driven!",
            "Your efforts are noticed!",
            "Keep up the momentum!",
            "You're achieving great things!",
            "Stay on your path!",
            "Your work ethic is strong!",
            "Keep pushing your limits!",
            "You're a dedicated worker!",
            "Stay on your journey!",
            "Your goals are within reach!",
            "Keep striving for excellence!",
            "You're a valuable team member!",
            "Stay focused on success!",
            "Your hard work is inspiring!",
            "Keep building your future!",
            "You're a committed worker!",
            "Stay on your mission!",
            "Your dedication is admirable!",
            "Keep moving forward!",
            "You're a determined worker!"
        ];

        function showRandomEncouragementMessage() {
            const messageElement = document.getElementById("encouragementMessage");
            const randomIndex = Math.floor(Math.random() * encouragementMessages.length);
            messageElement.textContent = encouragementMessages[randomIndex];
        }

        window.onload = function() {
            populateTeamSelect(); // Populate team select on load
            const teamSelect = document.getElementById("teamSelect");
            teamSelect.addEventListener('change', () => {
                updateTable();
            });

            // Show a random encouragement message every 5 minutes
            showRandomEncouragementMessage();
            setInterval(showRandomEncouragementMessage, 300000); // 300000 ms = 5 minutes
        };
    </script>
</body>
</html>
